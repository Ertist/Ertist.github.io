---
title: Javascript学习笔记（二）
data: 2017-10-29
---

## 1.基本类型与引用类型的值

ECMAScript变量包含的值有两种类型

- 基本类型值：一般为简单的数据段，如js的五种基本数据类型，它们是按值访问的，可以操作保存在变量中的实际值。
- 引用类型值：可以理解为可能由多个值构成的对象；js不允许直接访问内存中的位置，即不能直接操作对象的内存空间。在操作对象时，一般操作的是对象的引用，引用类型的值是按引用来访问的（一般是这样，但为对象添加属性时，操作的是实际的对象）。

引用类型的值具有动态的属性，如在定义一个引用类型后可以给他添加或者删除属性和方法，而基本类型就不行。

``` javascript
var name = "kym";
name.age = 22;
alert(name.age);             //undefined
```

### 1.1 复制变量值

``` javascript
var num1 = 9;
var num2 = num1;          //num = 9; num2 = 9;
/*
这个过程并不是把num1的值传递到num2中，而是在变量对象上创建一个新值，然后把这个新值复制到为新变量分配的位置上，故num2以后的操作不会影响num1。
*/
```

``` javascript
var obj1 = new Object();
var obj2 = obj1;
obj1.name = "kym";
alert(obj2.name);          //"kym"
/*
相比基本类型的值，obj1和obj2指向的是同一个对象，当obj1添加name属性后，可以通过obj2来访问这个对象。
*/
```

### 1.2 传递参数

ECMAScript中所有函数的参数都是按值传递的。
向参数传递基本类型的值时，被传递的值会被复制给一个局部变量。而向参数传递引用类型的值时，会把这个变量在内存中的地址复制给一个局部变量，所以这个局部变量的变化会反映在函数的外部。

``` javascript
function test1(obj1){
  obj1.name = "kym";
}
var person = new Object();
test1(person);
alert(person.name);   // "kym"
```

``` javascript
function test2(obj2){
  obj2.name = "kym";
  obj2 = new Object();
  obj2.name = "wgj";
}
var person = new Object();
test2(person);
alert(person.name);   // "kym"
/*
这是因为在函数内重写obj2时，这个变量引用的是一个局部对象，这个局部对象会在函数结束后被销毁，同时也证明了函数的参数是按值传递的，不是按引用传递的。
*/
```

### 1.3 检测类型

基本数据类型的变量用`typeof`操作符即可以检测；而引用类型的值，可以通过`instanceof`操作符来知道它是什么类型的对象（instanceof操作符在检测基本数据类型的值时返回的是false,因为基本数据类型的值不是对象）。

``` javascript
alert(person instanceof Object);   //变量person是Object吗？
alert(colors instanceof Array);    //变量colors是Array吗？
alert(pattern instanceof RegExp);  //变量pattern是RegExp吗？
```

## 2.执行环境及作用域

#### 2.1 执行环境

执行环境定义了变量或者函数有权访问的其他数据，每个执行环境都有一个关联的变量对象，环境中定义所有函数和变量都保存在这个对象变量中（解析器在后台处理数据时会用到变量对象）

某个执行环境中所有代码执行完毕后，环境会被销毁，保存在里边的所有函数定义和变量也会被销毁。
全局环境为最外围的一个执行环境，在Web浏览器中，被认为是window对象。

#### 2.2 作用域

代码在执行环境中运行的时候，会创建一个作用域链，它的作用是保证那些对执行环境有权访问的变量和函数能有序访问。作用域的前端，始终是当前执行的代码。全局执行环境的变量对象时准时作用域链中的最后一个对象。
内部环境可以通过作用域链访问所有外部环境，但外部环境不能访问内部环境中的任何变量和函数。
作用域没有块级的
``` javascript
if(true){
  var color = "blue";
}
alert(color);             //blue

for(var i = 0; i < 10; i++){
  //dosomething
}
alert(i);                 //i = 10

/*
这是js与其他编程语言的不同，在if、for这种块级内声明的变量不会随着块运行结束而销毁，而是将它添加在了当前的执行环境中。
*/
```

如果局部执行环境中存在与父级执行环境同名的标识符，就不会使用父级环境长的标识符。

## 3.垃圾收集

Js具有自动垃圾收集机制，它的原理是找出那些不再继续使用的变量，然后释放其占用的内存。故她会按照固定的时间间隔周期性的执行这一操作。

一般采用标记清除，引用清除有时候会出现循环引用的问题。

优化内存占用最佳的方式，就是为执行中的代码只保存必要的数据。一旦数据不再有用，最好将其值设为null来释放其引用（解除引用），适合大多数全局变量和全局对象的属性。解除引用的真正作用是让值脱离执行环境，以便垃圾收集器下次回收时将其回收。

## 4.小结

这一块的内容知识点不多，但在写的过程中不能很好的总结出来，一方面书上对概念已经解释的很精辟了，另一方面可能与自己的掌握有关，暂且就先这么写上去，等以后对javascript理解更深的时候，回头再看这些东西可能就清晰了。